<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="utils/css/bootstrap.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" type="text/css" href="main.css">
    <link rel="stylesheet" href="TemplateTesting/footer.css">
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="utils/jquery-latest.js"></script>
    <script src="utils/popper.min.js"></script>
    <script src="utils/js/bootstrap.min.js"></script>

    <title>Edu Eats</title>

  </head>


  <body onload="on_load()">
    <div class="container collapse" id="basketCollapse">
      <div class="pt-3 pb-3 border-bottom container">
        <div class="row">
          <div class="col-6">
            <h3 class="serif">Your Basket (<span id=basket_items>0</span>)</h3>
          </div>
          <div class="col-6">
            <button type="button" class="btn btn-default float-right sansserif" data-toggle="collapse" data-target="#basketCollapse">Close X</button>
          </div>
        </div>
      </div>
      <div class="container text-center pt-3">
        <a class="btn btn-secondary" href="Cataleg.html">Add Meal</a>
      </div>

      <div class="pt-3 pb-3 d-flex container justify-content-center border-bottom">
        <table class="table table-bordered w-auto mt-2">
          <thead>
            <tr class="serif">
              <th scope="col">Week Day</th>
              <th scope="col">Plates</th>
            </tr>
          </thead>
          <tbody class="sansserif">
            <tr>
             <th scope="row">Monday</th>
             <td>
               <div class="container">
                 <div class="row" id="basket_monday">
                 </div>
               </div>
             </td>
            </tr>

            <tr>
              <th scope="row">Tuesday</th>
              <td>
                <div class="container">
                  <div class="row" id="basket_tuesday">
                  </div>
                </div>
              </td>
            </tr>

            <tr>
              <th scope="row">Wednesday</th>
              <td>
                <div class="container" id="basket_wednesday">
                  <div class="row">
                  </div>
                </div>
              </td>
            </tr>

            <tr>
              <th scope="row">Thursday</th>
              <td>
                <div class="container" id="basket_thursday">
                  <div class="row">
                  </div>
                </div>
              </td>
            </tr>

            <tr>
              <th scope="row">Friday</th>
              <td>
                <div class="container" id="basket_friday">
                  <div class="row">
                  </div>
                </div>
              </td>
            </tr>

            <tr>
              <th scope="row">Saturday</th>
              <td>
                <div class="container" id="basket_saturday">
                  <div class="row">
                  </div>
                </div>
              </td>
            </tr>

            <tr>
              <th scope="row">Sunday</th>
              <td>
                <div class="container" id="basket_sunday">
                  <div class="row">
                  </div>
                </div>
              </td>
            </tr>

          </tbody>
        </table>
      </div>
      <div class="pt-3 pb-3 pl-5 pr-5 container border-bottom sansserif">
        <div class="row">
          <div class="col-6">
            <span>SUBTOTAL</span>
          </div>
          <div class="col-6">
            <span class="float-right" id="basket_price">0.0 $</span>
          </div>
        </div>
      </div>
      <div class="pt-3 pb-3 pl-5 pr-5 container border-bottom d-flex justify-content-center sansserif">
        <a type="button" class="btn btn-primary" href="Success.html">Checkout</a>
      </div>
    </div>

    <div class="container-fluid brand-color navbar-pad">
      <div class="container">
        <div class="row no-gutters">
          <div class="col-8">
            <nav class="navbar navbar-expand-md navbar-light">
              <button class="navbar-toggler btn-nav" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>
              <a class="navbar-brand mx-auto serif" href="Home.html">Edu Eats</a>
              <div class="collapse navbar-collapse mx-auto" id="navbarSupportedContent">
                <ul class="navbar-nav mr-auto">
                  <li class="nav-item">
                    <a class="nav-link  mx-auto" href="Home.html">Home</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link  mx-auto" href="Cataleg.html">Our Meals</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link  mx-auto" href="NotFound.html">Weekly Diets</a>
                  </li>
                </ul>
              </div>
            </nav>
          </div>
          <div class="col pr-4 pt-2 pb-3">
            <button type="button" class="btn float-right btn-nav" data-toggle="collapse" data-target="#basketCollapse">Basket (<span id="navbar_basket_items">0</span>)</button>
          </div>
        </div>
      </div>
    </div>

    <div class="container text-center">
      <img src="assets/general/404.png" style="width:50%;">
    </div>

    <!-- Footer -->
  	<section id="footer">
  		<div class="container">
  			<div class="row text-center text-xs-center text-sm-left text-md-left">
  				<div class="col-xs-12 col-sm-4 col-md-4">
  					<h5>Quick links</h5>
  					<ul class="list-unstyled quick-links">
  						<li><a href="Home.html"><i class="fa fa-angle-double-right"></i>Home</a></li>
  						<li><a href="Cataleg.html"><i class="fa fa-angle-double-right"></i>Our Meals</a></li>
  						<li><a href="NotFound.html"><i class="fa fa-angle-double-right"></i>Weekly Diets</a></li>
  					</ul>
  				</div>
  			</div>
  			<div class="row">
  				<div class="col-xs-12 col-sm-12 col-md-12 mt-2 mt-sm-5">
  					<ul class="list-unstyled list-inline social text-center">
  						<li class="list-inline-item"><a href="NotFound.html"><i class="fa fa-facebook"></i></a></li>
  						<li class="list-inline-item"><a href="NotFound.html"><i class="fa fa-twitter"></i></a></li>
  						<li class="list-inline-item"><a href="NotFound.html"><i class="fa fa-instagram"></i></a></li>
  						<li class="list-inline-item"><a href="NotFound.html"><i class="fa fa-google-plus"></i></a></li>
  						<li class="list-inline-item"><a href="NotFound.html" target="_blank"><i class="fa fa-envelope"></i></a></li>
  					</ul>
  				</div>
  				<hr>
  			</div>
  			<div class="row">
  				<div class="col-xs-12 col-sm-12 col-md-12 mt-2 mt-sm-2 text-center">
  					<p class="h6">Â© All right Reversed.<a class="ml-2" href="NotFound.html" target="_blank">EduEats</a></p>
  				</div>
  				<hr>
  			</div>
  		</div>
  	</section>
    <!-- ./Footer -->

    <template id="basket_meal">
      <div class="card card-basket">
        <img id="card_img" class="img-fluid card-img-top card-basket-image" src="assets\plats\canelons.png" alt="Plat">

        <div class="card-body border-bottom pt-2 pb-2 pl-1 pr-1">
          <div class="container">
            <div class="row">
              <div class="col-6 d-flex align-items-center">
                 <h5 class="feature-title mb-0 mt-0 card-title-font serif" id="card_title" >Tagliatelle</h5>
              </div>
              <div class="col-6">
                <button id="card_selector" class="btn btn-danger float-right pt-0 pb-0 pl-0 pr-0 card-basket-button" data-idx="#" data-day="#" onclick="remove_from_basket(this.getAttribute('data-idx'), this.getAttribute('data-day'))">&#x2015;</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </template>

    <script>
      var imgFolder = "assets/plats/";

      function remove_from_basket(meal_idx, day){
        console.log(""+meal_idx+" "+day);
        var bc = getCookie('basket');
        if(bc != ""){
          var basket_list = JSON.parse(bc);
          basket_list[day].splice(meal_idx, 1);
        }
        var basket_string = JSON.stringify(basket_list);
        setCookie('basket', basket_string, 1);
        update_basket();
      }

      function update_basket(){
        var bc = getCookie('basket');
        console.log("cookie: "+bc);
        var item = document.getElementById("basket_meal").content.querySelector("div");
        if(bc != ""){
          var basket_list = JSON.parse(bc);
          console.log("basket_list" + typeof(basket_list));
          var basketday = ['basket_monday', 'basket_tuesday', 'basket_wednesday', 'basket_thursday', 'basket_friday', 'basket_saturday', 'basket_sunday'];
          var total_price = 0;
          var total_items = 0;
          for(var i = 0; i < basketday.length; i++){
            var day_n = document.getElementById(basketday[i]);
            while (day_n.lastElementChild) {
              day_n.removeChild(day_n.lastElementChild);
            }
            var meal_list = basket_list[i];
            for(var j = 0; j < meal_list.length; j++){
              console.log("basket_item "+ meal_list[j]);
              var newCard = document.importNode(item, true);
              var img = newCard.querySelector("#card_img");
              img.src=imgFolder.concat(meal_list[j].thumbnail);
              img.alt=meal_list[j].name;
              var title = newCard.querySelector("#card_title");
              title.textContent = meal_list[j].name;
              var deleteDom = newCard.querySelector("#card_selector");
              deleteDom.setAttribute('data-idx', j);
              deleteDom.setAttribute('data-day', i);
              total_price += meal_list[j].price;
              total_items += 1;
              day_n.appendChild(newCard);
            }
          }
          console.log("total_items: "+total_items);
          document.getElementById("basket_price").textContent=""+total_price+" $";
          document.getElementById("basket_items").textContent=""+total_items;
          document.getElementById("navbar_basket_items").textContent=""+total_items;
        }
      }

      function setCookie(cname, cvalue, exdays) {
        var d = new Date();
        d.setTime(d.getTime() + (exdays*24*60*60*1000));
        var expires = "expires="+ d.toUTCString();
        document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
      }

      function getCookie(cname) {
        var name = cname + "=";
        var decodedCookie = decodeURIComponent(document.cookie);
        console.log("decodedCookie: "+decodedCookie);
        var ca = decodedCookie.split(';');
        for(var i = 0; i <ca.length; i++) {
          var c = ca[i];
          while (c.charAt(0) == ' ') {
            c = c.substring(1);
          }
          if (c.indexOf(name) == 0) {
            return c.substring(name.length, c.length);
          }
        }
        return "";
      }

      function on_load(){
        update_basket();
      }

    </script>
  </body>



</html>
