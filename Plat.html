<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="utils/css/bootstrap.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" type="text/css" href="main.css">
    <link rel="stylesheet" href="plat.css">
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="utils/jquery-latest.js"></script>
    <script src="utils/popper.min.js"></script>
    <script src="utils/js/bootstrap.min.js"></script>
  </head>



  <body onload="on_load()">
    <div class="container collapse" id="basketCollapse">
      <div class="pt-3 pb-3 border-bottom container">
        <div class="row">
          <div class="col-6">
            <h3 class="serif">Your Basket (<span id=basket_items>0</span>)</h3>
          </div>
          <div class="col-6">
            <button type="button" class="btn btn-default float-right sansserif" data-toggle="collapse" data-target="#basketCollapse">Close X</button>
          </div>
        </div>
      </div>
      <div class="pt-3 pb-3 d-flex container justify-content-center border-bottom">
        <table class="table table-bordered w-auto mt-2">
          <thead>
            <tr class="serif">
              <th scope="col">Week Day</th>
              <th scope="col">Plates</th>
            </tr>
          </thead>
          <tbody class="sansserif">
            <tr>
             <th scope="row">Monday</th>
             <td>
               <div class="container">
                 <div class="row" id="basket_monday">
                 </div>
               </div>
             </td>
            </tr>

            <tr>
              <th scope="row">Tuesday</th>
              <td>
                <div class="container">
                  <div class="row" id="basket_tuesday">
                  </div>
                </div>
              </td>
            </tr>

            <tr>
              <th scope="row">Wednesday</th>
              <td>
                <div class="container" id="basket_wednesday">
                  <div class="row">
                  </div>
                </div>
              </td>
            </tr>

            <tr>
              <th scope="row">Thursday</th>
              <td>
                <div class="container" id="basket_thursday">
                  <div class="row">
                  </div>
                </div>
              </td>
            </tr>

            <tr>
              <th scope="row">Friday</th>
              <td>
                <div class="container" id="basket_friday">
                  <div class="row">
                  </div>
                </div>
              </td>
            </tr>

            <tr>
              <th scope="row">Saturday</th>
              <td>
                <div class="container" id="basket_saturday">
                  <div class="row">
                  </div>
                </div>
              </td>
            </tr>

            <tr>
              <th scope="row">Sunday</th>
              <td>
                <div class="container" id="basket_sunday">
                  <div class="row">
                  </div>
                </div>
              </td>
            </tr>

          </tbody>
        </table>
      </div>
      <div class="pt-3 pb-3 pl-5 pr-5 container border-bottom sansserif">
        <div class="row">
          <div class="col-6">
            <span>SUBTOTAL</span>
          </div>
          <div class="col-6">
            <span class="float-right" id="basket_price">0.0 $</span>
          </div>
        </div>
      </div>
      <div class="pt-3 pb-3 pl-5 pr-5 container border-bottom d-flex justify-content-center sansserif">
        <a type="button" class="btn btn-primary" href="Success.html">Checkout</a>
      </div>
    </div>

    <div class="container-fluid brand-color navbar-pad">
      <div class="container">
        <div class="row no-gutters">
          <div class="col-8">
            <nav class="navbar navbar-expand-md navbar-light">
              <button class="navbar-toggler btn-nav" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>
              <a class="navbar-brand mx-auto serif" href="Home.html">Edu Eats</a>
              <div class="collapse navbar-collapse mx-auto" id="navbarSupportedContent">
                <ul class="navbar-nav mr-auto">
                  <li class="nav-item">
                    <a class="nav-link  mx-auto" href="Home.html">Home</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link  mx-auto" href="Cataleg.html">Our Meals</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link  mx-auto" href="NotFound.html">Weekly Diets</a>
                  </li>
                </ul>
              </div>
            </nav>
          </div>
          <div class="col pr-4 pt-2 pb-3">
            <button type="button" class="btn float-right btn-nav" data-toggle="collapse" data-target="#basketCollapse">Basket (<span id="navbar_basket_items">0</span>)</button>
          </div>
        </div>
      </div>
    </div>

    <div class="container pl-0 pr-0">
      <div>
        <div id="carouselExampleSlidesOnly" class="carousel slide" data-ride="carousel">
          <div class="carousel-inner">
            <div class="carousel-item active">
              <img class="d-block w-100 imgCarousel img-fluid" src="assets\plats\tagliattelle.png">
            </div>
            <div class="carousel-item">
              <img class="d-block w-100 imgCarousel img-fluid" src="assets\plats\tagliattelle_raw.png">
            </div>
          </div>
        </div>
      </div>
      <section>
        <h1>Tagliatelle</h1>
        <span>
          <p class="subtitle"> Ración de 450 g<p>
        </span>
      </section>
      <section>
        <p class="plat_exp">Empleamos la grasa del pato para el sofrito, al que agregamos ajos asados, setas y vino blanco. Agregamos hierbas, el confit desmigado y mojamos con caldo de ave. Para terminar añadimos pimientos del piquillo y crema de emmental y gorgonzola.<p>
      </section>
      <section>
        <div id="accordion">
          <div class="card">
            <div class="card-header" id="headingOne">
              <h5 class="mb-0">
                <button class="btn collapsed" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                  INGREDIENTS
                </button>
              </h5>
            </div>
            <div id="collapseOne" class="collapse" aria-labelledby="headingOne" data-parent="#accordion">
              <div class="card-body">
                <p> Caldo de pollo (agua, carcasa de pollo, alitas de pollo, zanahoria, cebolla, aceite de oliva, ajo pelado, laurel, sal), arroz carnarolli (41%), confit de pato (7%), setas en proporción variable: Seta de cardo, shitake, pholiota nameko, champiñón, vino blanco, oloroso, nata, pimientos del piquillo, sofrito de cebolla, grasa de pato, ajo tostado, queso emmental (con leche pasteurizada), queso gorgonzola (2%) (con leche pasteurizada), sal y romero. Lácteos.Este plato puede contener otros alérgenos ya que, por el momento, todos los platos se elaboran artesanalmente en el mismo obrador.
                </p>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header" id="headingTwo">
              <h5 class="mb-0">
                <button class="btn collapsed" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                  NUTRITIONAL VALUE
                </button>
              </h5>
            </div>
            <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordion">
              <div class="card-body">
                <div class="table">
                  <table>
                    <thead>
                      <tr class="header">
                        <td>
                        </td>
                        <td>
                          <strong>Por cada 100g</strong>
                        </td>
                        <td>
                          <strong>Ración 450 g</strong>
                        </td>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td class="nutrient">Energía</td>
                        <td>210,50 kcal</td>
                        <td>947,25 kcal</td>
                      </tr>
                      <tr>
                        <td class="nutrient">Carbohidratos</td>
                        <td>23,61 g</td>
                        <td>106,25 g</td>
                      </tr>
                      <tr>
                        <td class="nutrient">Grasas totales</td>
                        <td>10,84 g</td>
                        <td>48,78 g</td>
                      </tr>
                      <tr>
                        <td class="nutrient">Azúcares</td>
                        <td>2,87 g</td>
                        <td>12,91 g</td>
                      </tr>
                    </tbody>
                  </table>
                  <table class="second-table">
                    <thead>
                      <tr class="header header-mobile">
                        <td>
                        </td>
                        <td>
                          <strong>Por cada 100g</strong>
                        </td>
                        <td>
                          <strong>Ración 450 g</strong>
                        </td>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td class="nutrient">Grasas saturadas</td>
                        <td>2,78 g</td>
                        <td>12,51 g</td>
                      </tr>
                      <tr>
                        <td class="nutrient">Fibra dietética</td>
                        <td>1,38 g</td>
                        <td>6,21 g</td>
                      </tr>
                      <tr>
                        <td class="nutrient">Proteínas</td>
                        <td>5,09 g</td>
                        <td>22,91 g</td>
                      </tr>
                      <tr>
                        <td class="nutrient">Sal</td>
                        <td>0,81 g</td>
                        <td>3,65 g</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <div class="opct my-auto">
        <p class="left" align="left">6.45€</p>
        <div class="dropup right">
          <button class="btn dropdown-toggle btn-sm float-right btn-nav brand-color" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            BUY
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
            <button class="dropdown-item" onclick="add_to_basket(0,0)">Monday</button>
            <button class="dropdown-item" onclick="add_to_basket(0,1)">Tuesday</button>
            <button class="dropdown-item" onclick="add_to_basket(0,2)">Wednesday</button>
            <button class="dropdown-item" onclick="add_to_basket(0,3)">Thursday</button>
            <button class="dropdown-item" onclick="add_to_basket(0,4)">Friday</button>
            <button class="dropdown-item" onclick="add_to_basket(0,5)">Saturday</button>
            <button class="dropdown-item" onclick="add_to_basket(0,6)">Sunday</button>
          </div>
        </div>
      </div>
      <div class="trns">
      </div>

    </div>

    <!-- Footer -->
    <section id="footer">
      <div class="container">
        <div class="row text-center text-xs-center text-sm-left text-md-left">
          <div class="col-xs-12 col-sm-4 col-md-4">
            <h5>Quick links</h5>
            <ul class="list-unstyled quick-links">
              <li><a href="Home.html"><i class="fa fa-angle-double-right"></i>Home</a></li>
              <li><a href="Cataleg.html"><i class="fa fa-angle-double-right"></i>Our Meals</a></li>
              <li><a href="NotFound.html"><i class="fa fa-angle-double-right"></i>Weekly Diets</a></li>
            </ul>
          </div>
        </div>
        <div class="row">
          <div class="col-xs-12 col-sm-12 col-md-12 mt-2 mt-sm-5">
            <ul class="list-unstyled list-inline social text-center">
              <li class="list-inline-item"><a href="NotFound.html"><i class="fa fa-facebook"></i></a></li>
              <li class="list-inline-item"><a href="NotFound.html"><i class="fa fa-twitter"></i></a></li>
              <li class="list-inline-item"><a href="NotFound.html"><i class="fa fa-instagram"></i></a></li>
              <li class="list-inline-item"><a href="NotFound.html"><i class="fa fa-google-plus"></i></a></li>
              <li class="list-inline-item"><a href="NotFound.html" target="_blank"><i class="fa fa-envelope"></i></a></li>
            </ul>
          </div>
          <hr>
        </div>
        <div class="row">
          <div class="col-xs-12 col-sm-12 col-md-12 mt-2 mt-sm-2 text-center">
            <p class="h6">© All right Reversed.<a class="ml-2" href="NotFound.html" target="_blank">EduEats</a></p>
          </div>
          <hr>
        </div>
      </div>
    </section>
    <!-- ./Footer -->

    <template id="basket_meal">
      <div class="card card-basket">
        <img id="card_img" class="img-fluid card-img-top card-basket-image" src="assets\plats\canelons.png" alt="Plat">

        <div class="card-body border-bottom pt-2 pb-2 pl-1 pr-1">
          <div class="container">
            <div class="row">
              <div class="col-6 d-flex align-items-center">
                 <h5 class="feature-title mb-0 mt-0 card-title-font serif" id="card_title" >Tagliatelle</h5>
              </div>
              <div class="col-6">
                <button id="card_selector" class="btn btn-danger float-right pt-0 pb-0 pl-0 pr-0 card-basket-button" data-idx="#" data-day="#" onclick="remove_from_basket(this.getAttribute('data-idx'), this.getAttribute('data-day'))">&#x2015;</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </template>

    <script>
      var imgFolder = "assets/plats/";
      var meal = {
              id : 0,
              name : "Tagliatelle",
              diet_tags : ["Mediterranean"],
              macro_tags: ["High Carbs", "Low Fat"],
              alergen_tags: ["Seafood Free"],
              thumbnail : "tagliattelle.png",
              price : 6.45};


      function remove_from_basket(meal_idx, day){
        console.log(""+meal_idx+" "+day);
        var bc = getStorage('basket');
        if(bc != ""){
          var basket_list = JSON.parse(bc);
          basket_list[day].splice(meal_idx, 1);
        }
        var basket_string = JSON.stringify(basket_list);
        setStorage('basket', basket_string);
        update_basket();
      }

      function add_to_basket(meal_id, day){
        console.log(""+meal_id+" "+day);
        var meal = getMeal(meal_id);
        var bc = getStorage('basket');
        if(bc == null){
          bc = [ [], [], [], [], [], [], [] ];
        }else{
          bc = JSON.parse(bc);
        }
        bc[day].push(meal);
        var basket_string = JSON.stringify(bc);
        setStorage('basket', basket_string);
        update_basket();
      }

      function getMeal(meal_id){
        return meal;
      }

      function update_basket(){
        var bc = getStorage('basket');
        console.log("cookie: "+bc);
        var item = document.getElementById("basket_meal").content.querySelector("div");
        if(bc != null){
          var basket_list = JSON.parse(bc);
          console.log("basket_list" + typeof(basket_list));
          var basketday = ['basket_monday', 'basket_tuesday', 'basket_wednesday', 'basket_thursday', 'basket_friday', 'basket_saturday', 'basket_sunday'];
          var total_price = 0;
          var total_items = 0;
          for(var i = 0; i < basketday.length; i++){
            var day_n = document.getElementById(basketday[i]);
            while (day_n.lastElementChild) {
              day_n.removeChild(day_n.lastElementChild);
            }
            var meal_list = basket_list[i];
            for(var j = 0; j < meal_list.length; j++){
              console.log("basket_item "+ meal_list[j]);
              var newCard = document.importNode(item, true);
              var img = newCard.querySelector("#card_img");
              img.src=imgFolder.concat(meal_list[j].thumbnail);
              img.alt=meal_list[j].name;
              var title = newCard.querySelector("#card_title");
              title.textContent = meal_list[j].name;
              var deleteDom = newCard.querySelector("#card_selector");
              deleteDom.setAttribute('data-idx', j);
              deleteDom.setAttribute('data-day', i);
              total_price += meal_list[j].price;
              total_items += 1;
              day_n.appendChild(newCard);
            }
          }
          console.log("total_items: "+total_items);
          document.getElementById("basket_price").textContent=""+total_price+" $";
          document.getElementById("basket_items").textContent=""+total_items;
          document.getElementById("navbar_basket_items").textContent=""+total_items;
        }
      }

      function setStorage(sname, svalue){
        var storage = window.localStorage;
        storage.setItem(sname, svalue);
      }

      function getStorage(sname){
        var storage = window.localStorage;
        return storage.getItem(sname);
      }

      function on_load(){
        update_basket();
      }

    </script>
  </body>
</html>
