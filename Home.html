<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="utils/css/bootstrap.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" type="text/css" href="main.css">
    <link rel="stylesheet" href="TemplateTesting/footer.css">
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="utils/jquery-latest.js"></script>
    <script src="utils/popper.min.js"></script>
    <script src="utils/js/bootstrap.min.js"></script>

    <title>Edu Eats</title>

  </head>

  <body onload="on_load()">
    <div class="container collapse" id="basketCollapse">
      <div class="pt-3 pb-3 border-bottom container">
        <div class="row">
          <div class="col-6">
            <h3 class="serif">Your Basket (<span id=basket_items>0</span>)</h3>
          </div>
          <div class="col-6">
            <button type="button" class="btn btn-default float-right sansserif" data-toggle="collapse" data-target="#basketCollapse">Close X</button>
          </div>
        </div>
      </div>
      <div class="container text-center pt-3">
        <a class="btn btn-secondary" href="Cataleg.html">Add Meal</a>
      </div>

      <div class="pt-3 pb-3 d-flex container justify-content-center border-bottom">
        <table class="table table-bordered w-auto mt-2">
          <thead>
            <tr class="serif">
              <th scope="col">Week Day</th>
              <th scope="col">Plates</th>
            </tr>
          </thead>
          <tbody class="sansserif">
            <tr>
             <th scope="row">Monday</th>
             <td>
               <div class="container">
                 <div class="row" id="basket_monday">
                 </div>
               </div>
             </td>
            </tr>

            <tr>
              <th scope="row">Tuesday</th>
              <td>
                <div class="container">
                  <div class="row" id="basket_tuesday">
                  </div>
                </div>
              </td>
            </tr>

            <tr>
              <th scope="row">Wednesday</th>
              <td>
                <div class="container" id="basket_wednesday">
                  <div class="row">
                  </div>
                </div>
              </td>
            </tr>

            <tr>
              <th scope="row">Thursday</th>
              <td>
                <div class="container" id="basket_thursday">
                  <div class="row">
                  </div>
                </div>
              </td>
            </tr>

            <tr>
              <th scope="row">Friday</th>
              <td>
                <div class="container" id="basket_friday">
                  <div class="row">
                  </div>
                </div>
              </td>
            </tr>

            <tr>
              <th scope="row">Saturday</th>
              <td>
                <div class="container" id="basket_saturday">
                  <div class="row">
                  </div>
                </div>
              </td>
            </tr>

            <tr>
              <th scope="row">Sunday</th>
              <td>
                <div class="container" id="basket_sunday">
                  <div class="row">
                  </div>
                </div>
              </td>
            </tr>

          </tbody>
        </table>
      </div>
      <div class="pt-3 pb-3 pl-5 pr-5 container border-bottom sansserif">
        <div class="row">
          <div class="col-6">
            <span>SUBTOTAL</span>
          </div>
          <div class="col-6">
            <span class="float-right" id="basket_price">0.0 $</span>
          </div>
        </div>
      </div>
      <div class="pt-3 pb-3 pl-5 pr-5 container border-bottom d-flex justify-content-center sansserif">
        <a type="button" class="btn btn-primary" href="Success.html">Checkout</a>
      </div>
    </div>

    <div class="container-fluid brand-color navbar-pad">
      <div class="container">
        <div class="row no-gutters">
          <div class="col-8">
            <nav class="navbar navbar-expand-md navbar-light">
              <button class="navbar-toggler btn-nav" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>
              <a class="navbar-brand mx-auto serif" href="Home.html">Edu Eats</a>
              <div class="collapse navbar-collapse mx-auto" id="navbarSupportedContent">
                <ul class="navbar-nav mr-auto">
                  <li class="nav-item">
                    <a class="nav-link  mx-auto" href="Home.html">Home</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link  mx-auto" href="Cataleg.html">Our Meals</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link  mx-auto" href="NotFound.html">Weekly Diets</a>
                  </li>
                </ul>
              </div>
            </nav>
          </div>
          <div class="col pr-4 pt-2 pb-3">
            <button type="button" class="btn float-right btn-nav" data-toggle="collapse" data-target="#basketCollapse">Basket (<span id="navbar_basket_items">0</span>)</button>
          </div>
        </div>
      </div>
    </div>

    <div class="container-fluid">
      <!-- Carousel de presentacio -->
      <div id="carouselHome" class="carousel slide" data-ride="carousel">
        <ol class="carousel-indicators">
          <li data-target="#carouselHome" data-slide-to="0" class="active"></li>
          <li data-target="#carouselHome" data-slide-to="1"></li>
          <li data-target="#carouselHome" data-slide-to="2"></li>
        </ol>
        <div class="carousel-inner">
          <div class="carousel-item active">
            <img class="d-block w-100" src="assets/general/slide3.jpg" alt="First slide">
            <div class="carousel-caption">
              <h5 style="background-color: rgba(105, 105, 105, 0.4)">Nourish what you want</h5>
            </div>
          </div>
          <div class="carousel-item">
            <img class="d-block w-100" src="assets/general/slide1.jpg" alt="Second slide">
            <div class="carousel-caption">
              <h5 style="background-color: rgba(105, 105, 105, 0.4)">We cook for you so that you can focus on what you care</h5>
            </div>
          </div>
          <div class="carousel-item">
            <img class="d-block w-100" src="assets/general/slide4.jpg" alt="Third slide">
            <div class="carousel-caption">
              <h5 style="background-color: rgba(105, 105, 105, 0.4)">Delicious. Fresh. Natural. Sustainable</h5>
            </div>
          </div>
        </div>
        <a class="carousel-control-prev" href="#carouselHome" role="button" data-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="sr-only">Previous</span>
        </a>
        <a class="carousel-control-next" href="#carouselHome" role="button" data-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="sr-only">Next</span>
        </a>
      </div>



      <!-- Feats destacats -->
      <div class="jumbotron jumbotron-fluid">
        <div class="container">
          <h4 class="display-4 serif">Our purpose</h4>
          <p class="lead">We want to build a world where eating healthy is not a problem, but a joy.</p>
        </div>

        <div class="container">
          <h4 class="display-4 serif">How does it work?</h4>
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Make your command</h5>
              <p class="card-text">Choose your meals for each day of the weak</p>
            </div>
          </div>
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">We cook</h5>
              <p class="card-text">We cook daily from raw foods.</p>
            </div>
          </div>
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Daily deliver</h5>
              <p class="card-text">We deliever your meals for each day.</p>
            </div>
          </div>
        </div>

        <div class="container" id=accordion>
          <h4 class="display-4 serif">Our philosophy</h4>

          <div class="card">
            <div class="card-header" id="headingOne">
              <h5 class="mb-0">
                <button class="btn btn-link sansserif" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                  The food we make has a part of ourselves.
                </button>
              </h5>
            </div>
            <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordion">
              <div class="card-body sansserif">
                Cooking is emotion. Choose, mix, smell, taste... We cook with memories that connect us to a place, a moment lived with that person from whom we learned to cook what we now cook for you.
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header" id="headingTwo">
              <h5 class="mb-0">
                <button class="btn btn-link collapsed sansserif" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                  We believe that cooking from scratch matters.
                </button>
              </h5>
            </div>
            <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordion">
              <div class="card-body sansserif">
                Getting a consistent flavor but rich nuances takes time. That is why in our kitchen we value the process. Without shortcuts. We cook everything from scratch, just like good restaurants do.
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header" id="headingThree">
              <h5 class="mb-0">
                <button class="btn btn-link collapsed sansserif" data-toggle="collapse" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                  We know that if we eat well we can change the world.
                </button>
              </h5>
            </div>
            <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#accordion">
              <div class="card-body sansserif">
                We cook for all those who dedicate their time to being more connected with the things and peaople they love. That they create beautiful things, that they fight for what they believe and that they seek to create a happier, more human world. For all of them we are here.
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Footer -->
  	<section id="footer">
  		<div class="container">
  			<div class="row text-center text-xs-center text-sm-left text-md-left">
  				<div class="col-xs-12 col-sm-4 col-md-4">
  					<h5>Quick links</h5>
  					<ul class="list-unstyled quick-links">
  						<li><a href="Home.html"><i class="fa fa-angle-double-right"></i>Home</a></li>
  						<li><a href="Cataleg.html"><i class="fa fa-angle-double-right"></i>Our Meals</a></li>
  						<li><a href="NotFound.html"><i class="fa fa-angle-double-right"></i>Weekly Diets</a></li>
  					</ul>
  				</div>
  			</div>
  			<div class="row">
  				<div class="col-xs-12 col-sm-12 col-md-12 mt-2 mt-sm-5">
  					<ul class="list-unstyled list-inline social text-center">
  						<li class="list-inline-item"><a href="NotFound.html"><i class="fa fa-facebook"></i></a></li>
  						<li class="list-inline-item"><a href="NotFound.html"><i class="fa fa-twitter"></i></a></li>
  						<li class="list-inline-item"><a href="NotFound.html"><i class="fa fa-instagram"></i></a></li>
  						<li class="list-inline-item"><a href="NotFound.html"><i class="fa fa-google-plus"></i></a></li>
  						<li class="list-inline-item"><a href="NotFound.html" target="_blank"><i class="fa fa-envelope"></i></a></li>
  					</ul>
  				</div>
  				<hr>
  			</div>
  			<div class="row">
  				<div class="col-xs-12 col-sm-12 col-md-12 mt-2 mt-sm-2 text-center">
  					<p class="h6">© All right Reversed.<a class="ml-2" href="NotFound.html" target="_blank">EduEats</a></p>
  				</div>
  				<hr>
  			</div>
  		</div>
  	</section>
    <!-- ./Footer -->

    <template id="basket_meal">
      <div class="card card-basket">
        <img id="card_img" class="img-fluid card-img-top card-basket-image" src="assets\plats\canelons.png" alt="Plat">

        <div class="card-body border-bottom pt-2 pb-2 pl-1 pr-1">
          <div class="container">
            <div class="row">
              <div class="col-6 d-flex align-items-center">
                 <h5 class="feature-title mb-0 mt-0 card-title-font serif" id="card_title" >Tagliatelle</h5>
              </div>
              <div class="col-6">
                <button id="card_selector" class="btn btn-danger float-right pt-0 pb-0 pl-0 pr-0 card-basket-button" data-idx="#" data-day="#" onclick="remove_from_basket(this.getAttribute('data-idx'), this.getAttribute('data-day'))">&#x2015;</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </template>

    <script>
      var imgFolder = "assets/plats/";

      function remove_from_basket(meal_idx, day){
        console.log(""+meal_idx+" "+day);
        var bc = getStorage('basket');
        if(bc != null){
          var basket_list = JSON.parse(bc);
          basket_list[day].splice(meal_idx, 1);
        }
        var basket_string = JSON.stringify(basket_list);
        setStorage('basket', basket_string);
        update_basket();
      }

      function update_basket(){
        var bc = getStorage('basket');
        console.log("cookie: "+bc);
        var item = document.getElementById("basket_meal").content.querySelector("div");
        if(bc != null){
          var basket_list = JSON.parse(bc);
          console.log("basket_list" + typeof(basket_list));
          var basketday = ['basket_monday', 'basket_tuesday', 'basket_wednesday', 'basket_thursday', 'basket_friday', 'basket_saturday', 'basket_sunday'];
          var total_price = 0;
          var total_items = 0;
          for(var i = 0; i < basketday.length; i++){
            var day_n = document.getElementById(basketday[i]);
            while (day_n.lastElementChild) {
              day_n.removeChild(day_n.lastElementChild);
            }
            var meal_list = basket_list[i];
            for(var j = 0; j < meal_list.length; j++){
              console.log("basket_item "+ meal_list[j]);
              var newCard = document.importNode(item, true);
              var img = newCard.querySelector("#card_img");
              img.src=imgFolder.concat(meal_list[j].thumbnail);
              img.alt=meal_list[j].name;
              var title = newCard.querySelector("#card_title");
              title.textContent = meal_list[j].name;
              var deleteDom = newCard.querySelector("#card_selector");
              deleteDom.setAttribute('data-idx', j);
              deleteDom.setAttribute('data-day', i);
              total_price += meal_list[j].price;
              total_items += 1;
              day_n.appendChild(newCard);
            }
          }
          console.log("total_items: "+total_items);
          document.getElementById("basket_price").textContent=""+total_price+" $";
          document.getElementById("basket_items").textContent=""+total_items;
          document.getElementById("navbar_basket_items").textContent=""+total_items;
        }
      }

      function setStorage(sname, svalue){
        var storage = window.localStorage;
        storage.setItem(sname, svalue);
      }

      function getStorage(sname){
        var storage = window.localStorage;
        return storage.getItem(sname);
      }

      function on_load(){
        update_basket();
      }

    </script>
  </body>
</html>
